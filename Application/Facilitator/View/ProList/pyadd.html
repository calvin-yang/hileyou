<extend name="Public/base"/>

<block name="style">

</block>

<block name="body">

    <div class="main-title">
        <h2>{$info['id']?'编辑':'新增'}景点</h2>
    </div>
    
    <form action="__SELF__" method="post" class="form-horizontal">

        <div class="form-item cf">
            <label class="item-label">景点封面图<span class="check-tips"></span></label>
            <div class="controls">
                <div id="main">
                   <div class="demo">
                        <div class="btn">
                            <span class="up_str">上传图片</span>
                             <span class="img_up"><input type="file" name="img" upUrl="{:U('ProList/imgUplode',array('type'=>'play'))}" at="logo_img_url" onchange="img_upload(this,'1');"></span>
                            <input id="logo_img_url" type="hidden" name="logo_img_url" />
                        </div>
                        <div class="progress">
                            <span class="bar"></span><span class="percent">0%</span >
                        </div>
                        <div class="files"></div>
                   </div>
                   <div class="col-md-12 column" id="showimg"></div>
                </div>
            </div>
        </div>

        <div class="form-item cf">
            <label class="item-label">景点图<span class="check-tips"></span></label>
            <div class="controls">
                <div id="main">
                   <div class="demo">
                        <div class="btn">
                            <span class="up_str">上传图片</span>
                            <span class="img_up"><input type="file" name="img" upUrl="{:U('ProList/imgUplode',array('type'=>'play'))}" at="attractions_img_url" dele="" onchange="img_upload(this,'2');"></span>
                            <input id="attractions_img_url" type="hidden" name="attractions_img_url" />
                        </div>
                        <div class="progress">
                            <span class="bar"></span><span class="percent">0%</span >
                        </div>
                        <div class="files"></div>
                        <!-- <div id="showimg"></div> -->

                   </div>
                   <div class="col-md-12 column" id="showimg"></div>
                </div>
            </div>
        </div>

        


        <div class="form-item cf">
            <label class="item-label">景点标题<span class="check-tips"></span></label>
            <div class="controls">
                <input type="text" class="text input-large " name="title" value="">
            </div>
        </div>

        <div class="form-item cf">
            <label class="item-label">景点名<span class="check-tips"></span></label>
            <div class="controls">
                <input type="text" class="text input-large " name="name" value="">
            </div>
        </div>

        <div class="form-item cf">
            <label class="item-label">联系人<span class="check-tips"></span></label>
            <div class="controls">
                <input type="text" class="text input-large " name="contact" value="">
            </div>
        </div>
        
        
        <div class="form-item cf">
            <label class="item-label">业主电话<span class="check-tips"></span></label>
            <div class="controls">
                <input type="text" class="text input-large " name="tel" value="">
            </div>
        </div>

        <div class="form-item cf">
            <label class="item-label">建议游玩时间<span class="check-tips">(请填写数字)</span></label>
            <div class="controls">
                <input type="text" class="text input-large " name="play_time" value="">
            </div>
        </div>


        <div class="form-item cf">
            <label class="item-label">景点类型<span class="check-tips"></span></label>
            <div class="">
                <select  id="type" name="type" class="chzn-select" multiple style="width:350px;"tabindex="6">
                    <volist name="type_list['name']" id="vo">
                        <option value="{$vo}">{$vo}</option>
                    </volist>
                </select>
                <input type="hidden" name="facilities" id="facilities" value="" />
            </div>
        </div>
        
        <div class="form-item cf">
            <label class="item-label">省份<span class="check-tips"></span></label>
            <div class="">
                <select style="width: 300px" class="chzn-select" id="provinces" name="provinces">
                        <option value="">--请选择--</option>
                </select>
            </div>
        </div>
        <!-- 市 -->
        <div class="form-item cf city"></div>
        <!-- 区 -->
        <div class="form-item cf county"></div>

        <div class="form-item cf">
            <label class="item-label">详细地址<span class="check-tips"></span></label>
            <div class="controls">
                <input type="text" class="text input-large " name="address" value="">
            </div>
        </div>
        
        
        <div class="form-item cf">
            <label class="item-label">附近交通<span class="check-tips"></span></label>
            <div class="controls">
                <label class="textarea input-large">
                    <textarea name="nearby_traffic"></textarea>
                </label>
            </div>
        </div>
        
        <div class="form-item cf">
            <label class="item-label">游玩攻略<span class="check-tips"></span></label>
            <div class="controls">
                <label class="textarea input-large">
                    <textarea name="play_strategy"></textarea>
                </label>
            </div>
        </div>

        <div class="form-item cf">
            <label class="item-label">温馨提示<span class="check-tips"></span></label>
            <div class="controls">
                <label class="textarea input-large">
                    <textarea name="sper_capita"></textarea>
                </label>
            </div>
        </div>

        <div class="form-item cf">
            <label class="item-label">介绍<span class="check-tips"></span></label>
            <div class="controls">
                <label class="textarea input-large">
                    <textarea name="introduce"></textarea>
                </label>
            </div>
        </div>


        <div class="form-item cf">
            <label class="item-label">(￥/人)价格<span class="check-tips"></span></label>
            <div class="controls">
                <input type="number" class="text input-large price" name="price" value="0">
            </div>
        </div>

        <div class="form-item cf">
            <label class="item-label">(￥/人)优惠价<span class="check-tips">(0：无优惠价)</span>
                <input type="number" class="text input-large " name="zhekou" value="0"  style="width:50px;" oninput="OnInput (this,event)" onpropertychange="OnPropChanged (this,event)">%

            </label>
            <div class="controls">
                <input type="number" class="text input-large favorable_price" name="favorable_price" value="0">
            </div>
        </div>

        <!-- vip价 start -->
        <volist name="vip_list" id="vo">
            <div class="form-item cf">
                <label class="item-label">((%折)/人){$vo.name}价<span class="check-tips">(0：无vip价)</span></label>
                <div class="controls">
                    <input type="number" class="text input-large " name="vip[]" value="{:$vo['discount']}">
                    <input type="hidden" class="text input-large " name="vip_id[]" value="{$vo.id}">
                </div>
            </div>
        </volist>
        <!-- vip价 end-->

        <div class="form-item cf">
            <label class="item-label">排序<span class="check-tips"></span></label>
            <div class="controls">
                <input type="number" class="text input-large " name="sort" value="0">
            </div>
        </div>


        <div class="form-item">
            <input type="hidden" name="id" value="{$info.id|default=''}">
            <button class="btn submit-btn ajax-post" id="submit" type="submit" target-form="form-horizontal">确 定</button>
            <button class="btn btn-return" onclick="javascript:history.back(-1);return false;">返 回</button>
        </div>
    </form>
</block>

<block name="script">
    <script type="text/javascript">
        $("document").ready(function(){
            $.ajax({
                type: "get",
                url: "{:U('Region/action')}", // type=1表示查询省份
                data: {"parent_id": "1", "type": "1"},
                dataType: "json",
                success: function(data) {
                    $.each(data, function(i, item) {
                        $("#provinces").append("<option value='" + item.region_id + "'>" + item.region_name + "</option>");
                    });
                    jQuery("#provinces").chosen({disable_search_threshold: 5});
                }
            });
        });
        $("#submit").click(function(){
            $("#facilities").val($("#facilitie").val());
        });
        // Think.setValue("type", {$info.type|default=0});
        // Think.setValue("group", {$info.group|default=0});
        //导航高亮
        $('.side-sub-menu').find('a[href="{:U('ProList/pylist')}"]').closest('li').addClass('current');
        // 然后在select元素上启用chose
        jQuery("#type").chosen({disable_search_threshold: 5});
        
        
        $("#provinces").change(function() {
            $.ajax({
                type: "get",
                url: "{:U('Region/action')}", // type =2表示查询市
                data: {"parent_id": $(this).val(), "type": "2"},
                dataType: "json",
                success: function(data) {
                    $(".city").html('<label class="item-label">市区<span class="check-tips"></span></label><div class=""><select style="width: 300px" class="chzn-select" id="citys" name="citys" onchange="citys_change(this);"><option value="">--请选择--</option></select></div>');
                    $.each(data, function(i, item) {
                        $("#citys").append("<option value='" + item.region_id + "'>" + item.region_name + "</option>");
                    });
                    jQuery("#citys").chosen({disable_search_threshold: 5});
                }
            });
        });

        function citys_change(_this){
            $.ajax({
                type: "get",
                url: "{:U('Region/action')}", // type =2表示查询市
                data: {"parent_id": $(_this).val(), "type": "3"},
                dataType: "json",
                success: function(data) {
                    $(".county").html('<label class="item-label">县区<span class="check-tips"></span></label><div class=""><select style="width: 300px" class="chzn-select" id="countys" name="countys"><option value="">--请选择--</option></select></div>');
                    $.each(data, function(i, item) {
                        $("#countys").append("<option value='" + item.region_id + "'>" + item.region_name + "</option>");
                    });
                    jQuery("#countys").chosen({disable_search_threshold: 5});
                }
            });
        }
    </script>

     <script type="text/javascript">
    // Firefox, Google Chrome, Opera, Safari, Internet Explorer from version 9
        function OnInput (_this,event) {
            var price = $(".price").val();

            if(price != ""){
                var favorable_price = price * ($(_this).val()/100);
                $('.favorable_price').val(favorable_price);
            }
        }
    // Internet Explorer
        function OnPropChanged (_this,event) {
            if (event.propertyName.toLowerCase () == "value") {
                var price = $(".price").val();
                if($price != ""){
                    var favorable_price = price * $(_this).val();
                    $('favorable_price').val(favorable_price);
                }
            }
        }
    </script>

</block>
